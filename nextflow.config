/*
 * ==================================================
 * EPSCoR-NASA Microbiome Pipeline configuration file
 * Version: v0.1
 * Author: Kanishka Manna & Hans Vasquez-Gross
 * Date: 2025-04-18
 * ==================================================
 */

/*
 * Manifest information
 * --------------------
 */


/* 
 * Define parameters
 * -----------------
 */

params {

    /*
        --------------------
        Execution parameters
        --------------------
     */
    help = false
    samplesheet = null
    output = "${baseDir}/results"
    force = false

    /*
        --------------------------
        Module specific parameters
        --------------------------
    */
    // KneadData
    kneaddata_db = "human_transcriptome:bowtie2,ribosomal_RNA:bowtie2"
    kneaddata_db_path = "${baseDir}/database"

    // MetaphlAn
    metaphlan_db_path = "${baseDir}/database"

}


 // Parameters for Humann module
//params.nucleotide_db = "path/to/humann-nucleotide-database"
//params.protein_db = "path/to/humann-protein-database"
//params.pathway_db = "metacyc"


/*
 * Define execution profiles for different environments
 * ----------------------------------------------------
 */

profiles {
    standard {
        process.executor = 'local'
        conda.enabled = true
        conda.channels = ['defaults', 'conda-forge', 'bioconda', 'biobakery']
        conda.createTimeout = '20 min'
        
        process {
            withLabel: 'kneaddata_conda' {
                conda = "assets/kneaddata.yaml"
            }

            withLabel: 'metaphlan_conda' {
                conda = "assets/metaphlan.yaml"
            }

            withLabel: 'humann_conda' {
                conda = "assets/humann.yaml"
            }

            withLabel: 'multiqc_conda' {
                conda = "assets/multiqc.yaml"
            }
        }
    }
}


/*
----------------------------------------------------------
  Capture exit codes from upstream processes when piping  
----------------------------------------------------------
*/
process.shell = ['/bin/bash', '-euo', 'pipefail']



/*
========================
        Help Message    
========================
*/

params.help_message = """

        Usage:

        ```
        nextflow main.nf \\
            --samplesheet path/to/INPUT.csv \\
            --output /path/to/OUTPUT_DIR \\
            --library PE \\
            --kneaddata_path /path/to/folder/kneaddata/database/download/ \\
            --kneaddata_db REFERENCE_DB \\
            --nucleotide_db /path/to/downloaded/nucleotide/database \\
            --protein_db /path/to/downloaded/protein/database \\
            --pathway_db metacyc
        ```

        parameter options:
            * --samplesheet : Absolute path to a CSV file where each row specifies the sample name and the file paths to paired-end FASTQ files (R1 and R2), separated by commas.

            * --output : Absoulute path to the output directory where results will be saved.

            * --library : sequencing library type, e.g., PE for paired-end or SE for single-end. (default: PE)

            * --kneaddata_path : Absolute path to saved or where to save knead_data databases (default: ./kneaddata_db/)

            * --kneaddata_db : comma seperated list with no spaces of databases for kneadata to use in database:build format  (default: human_transcriptome:bowtie2,ribosomal_RNA:bowtie2)
                    Possible options: 
                    human_transcriptome:bowtie2, ribosomal_RNA:bowtie2, mouse_C57BL:bowtie2, dog_genome:bowtie2, cat_genome:bowtie2, human_genome:bmtagger

                    There currently is a bug in the current kneaddata v0.12.2 release of kneaddata for human_genome:bowtie2. This will be fixed in 0.12.3.
                    You can manually create the "human_genome_bowtie2" directory and manually download the correct file here 
                    https://huttenhower.sph.harvard.edu/kneadData_databases/Homo_sapiens_hg39_T2T_Bowtie2_v0.1.tar.gz

                    and extract it into the kneaddata_path/human_genome_bowtie2 directory. The within that directory run the following command: touch .done
            
            * --nucleotide_db : Specify the directory containing the nucleotide database

            * --protein_db : Specify the directory containing the protein database
            
            * --pathway_db : Specify the database to use for pathway {metacyc, unipathways} computations (default: metacyc)
    """